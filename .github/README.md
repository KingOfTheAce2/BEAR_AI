# GitHub Actions CI/CD Pipeline for BEAR AI Legal Assistant

This directory contains the comprehensive GitHub Actions workflows for building, testing, and deploying the BEAR AI Legal Assistant Tauri application.

## 🚀 Workflows Overview

### 1. CI/CD Pipeline (`ci-cd.yml`)
**Main workflow for comprehensive build and deployment**

**Triggers:**
- Push to `main` and `develop` branches
- Release tags (`v*`)
- Published releases

**Features:**
- ✅ Cross-platform builds (Windows, macOS, Linux)
- ✅ Automated testing (unit, integration, e2e, API)
- ✅ Security scanning and code quality checks
- ✅ Dependency caching for optimal performance
- ✅ Release automation with downloadable binaries
- ✅ Multiple architecture support (x64, ARM64 for macOS)

**Build Artifacts:**
- **Windows**: `.exe` and `.msi` installers
- **macOS**: `.app` bundle and `.dmg` installer (Intel & Apple Silicon)
- **Linux**: `.deb` package and `.AppImage`

### 2. Pull Request Validation (`pr-validation.yml`)
**Lightweight validation for pull requests**

**Features:**
- ✅ Quick TypeScript and Rust validation
- ✅ Code quality checks (ESLint, Clippy)
- ✅ Security scanning
- ✅ Test execution
- ✅ Build verification
- ✅ PR size analysis with automated comments

### 3. Security Audit (`security-audit.yml`)
**Daily security scanning and vulnerability detection**

**Features:**
- ✅ NPM package vulnerability scanning
- ✅ Rust crate security audit
- ✅ File system vulnerability scanning with Trivy
- ✅ Secret detection with TruffleHog
- ✅ SARIF upload to GitHub Security tab

### 4. Cache Cleanup (`cache-cleanup.yml`)
**Repository maintenance and cache management**

**Features:**
- ✅ Weekly automated cache cleanup
- ✅ Artifact lifecycle management
- ✅ Storage optimization
- ✅ Cleanup reporting

## 🔧 Required Secrets

Add these secrets to your GitHub repository:

### Required for Tauri Signing (Optional but Recommended)
```bash
TAURI_PRIVATE_KEY      # Private key for update signing
TAURI_KEY_PASSWORD     # Password for the private key
```

### Auto-generated by GitHub
```bash
GITHUB_TOKEN          # Automatically provided by GitHub Actions
```

## 📋 Setup Instructions

### 1. Initial Setup
The workflows are ready to use immediately after merging. No additional setup required.

### 2. Generating Tauri Signing Keys (Optional)
For secure updates, generate signing keys:

```bash
# In your project root
npx @tauri-apps/cli signer generate -w ~/.tauri/myapp.key
```

Add the generated key and password as repository secrets.

### 3. Branch Protection Rules (Recommended)
Configure branch protection for `main`:
- Require status checks from PR validation
- Require up-to-date branches
- Include administrators in restrictions

## 🚀 Triggering Builds

### Development Builds
- **Push to main/develop**: Triggers full CI/CD pipeline
- **Pull Request**: Triggers PR validation only
- **Manual**: Use "Run workflow" in GitHub Actions tab

### Release Builds
1. Create a new release with tag `v1.0.0` (semantic versioning)
2. The CI/CD pipeline automatically:
   - Builds for all platforms
   - Runs security scans
   - Creates downloadable binaries
   - Updates the release with assets

### Release Tag Format
Use semantic versioning for releases:
- `v1.0.0` - Major release
- `v1.0.1` - Patch release
- `v1.1.0` - Minor release
- `v2.0.0-beta.1` - Pre-release

## 📊 Performance Optimizations

### Caching Strategy
- **Node.js**: NPM dependencies cached per `package-lock.json` hash
- **Rust**: Cargo dependencies cached per `Cargo.lock` hash and target platform
- **Build artifacts**: Temporary caching for workflow coordination

### Parallel Execution
- Tests run in parallel across platforms
- Security scans run concurrently with builds
- Multiple jobs execute simultaneously when possible

### Build Time Optimizations
- Incremental builds with Rust cache
- Dependency pre-installation
- Optimized Docker layers for Linux builds

## 🔍 Monitoring and Debugging

### Workflow Status
Monitor workflow status in:
- GitHub Actions tab
- PR checks
- Email notifications (if enabled)
- GitHub mobile app

### Debugging Failed Builds
1. Check the specific job that failed
2. Review logs in the Actions tab
3. Look for error messages in job output
4. Check artifact uploads for partial builds

### Common Issues and Solutions

**Build Failures:**
- Check Node.js version compatibility
- Verify Rust toolchain installation
- Review dependency conflicts

**Test Failures:**
- Review test output in job logs
- Check for platform-specific issues
- Verify test data and fixtures

**Security Scan Issues:**
- Update vulnerable dependencies
- Review and approve security exceptions
- Check secret detection false positives

## 📈 Metrics and Reporting

### Automated Reports
- Test coverage reports (uploaded to Codecov)
- Security scan results (GitHub Security tab)
- Build artifacts with download counts
- Cache cleanup summaries

### Performance Metrics
- Build time tracking per platform
- Cache hit rates
- Test execution times
- Deployment success rates

## 🔄 Dependency Management

### Dependabot Configuration
Automated dependency updates configured for:
- NPM packages (weekly, grouped by ecosystem)
- Rust crates (weekly, grouped by function)
- GitHub Actions (monthly)

### Update Strategy
- Security updates: Immediate
- Minor updates: Weekly batches
- Major updates: Manual review required

## 🛡️ Security Features

### Automated Security Scanning
- Daily vulnerability scans
- Dependency audit on every PR
- Secret detection in commits
- SARIF integration with GitHub Security

### Security Best Practices
- Minimal required permissions for jobs
- Secure secret handling
- No hardcoded credentials
- Regular security updates

## 📝 Contributing to Workflows

### Modifying Workflows
1. Test changes in a feature branch
2. Create PR with workflow changes
3. Review impacts on build times
4. Monitor first runs after merge

### Adding New Jobs
1. Follow existing naming conventions
2. Add appropriate caching strategies
3. Include error handling
4. Document new requirements

### Best Practices
- Keep jobs focused and atomic
- Use official actions when possible
- Cache dependencies aggressively
- Provide clear error messages

## 🔗 Useful Links

- [Tauri Action Documentation](https://github.com/tauri-apps/tauri-action)
- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [Rust Toolchain Action](https://github.com/dtolnay/rust-toolchain)
- [Node.js Setup Action](https://github.com/actions/setup-node)

---

**Need Help?** Check the [GitHub Issues](https://github.com/KingOfTheAce2/BEAR_AI/issues) or create a new issue for workflow-related problems.